# [7장 파일시스템]

### 개요

- 파일시스템이 없다면, 저장 장치내 메모리 관리가 되지 않을 것.
    - 빈 영역을 관리할 필요가 있음.
    - 어디다 저장했는지 메모라이징할 필요가 있음.

> ***이렇게 저장 장치 내 데이터와 빈 공간을 관리하는 방법이 파일시스템 입니다.***
> 
- 프로세스가 시스템콜을 통해 커널에게 파일시스템 처리를 요청하면, 하드웨어 메모리 내의 파일시스템 스토리지를 참고하여 데이터를 전달 합니다.

---

### 리눅스의 파일시스템

- 루트 구조로 리눅스의 파일시스템은  `ext4`, `XFS` , `Btrfs` 등이 존재합니다.
- 종류가 다양할지라도, 시스템콜을 통해 호출되는 인터페이스는 동일합니다.
    - 쉽게 추상클래스 `파일시스템` 이라고 생각하면 좋을 것 같습니다.
- 데이터는 데이터와 메타데이터로 나뉠 수 있으며, 메타데이터는 데이터를 위한 보조정보를 의미합니다.

---

### 파일시스템의 손상

- 보통 파일시스템이 저장되거나 수정되는 동안 전원이 꺼지거나, 다른 이유로 처리가 중단된다면 파일시스템이 깨지는 경우가 존재합니다.
    - 예를들어 `mv foo /app` 이라는 명령어를 통해 `foo` 파일을 `/app` 폴더로 이동시키는 명령어 중 전원이 단절되어 파일시스템이 손상되는 경우라면, 파일시스템의 마운트가 불가능하게 되어집니다.
- 이런 손상을 막기 위해 `저널링` 과 `Copy on Write` 방법이 존재합니다.
    1. 저널링(`ext4`, `XFS`)
        - 저널이라는 메타데이터 영역을 정의하여, 업데이트에 필요한 (아토믹한) 처리의 목록을 작성하고 이를 기준으로 업데이트 합니다.
        - 저널로그를 작성 중 전원이 단절되었더라도, 저널로그만 날라갈 뿐 실제데이터는 안전하며, 저널로그를 기준으로 업데이트 중 전원이 단절되었다면, 저널로그를 따라 다시 업데이트를 진행하고 저널로그를 삭제합니다.
    2. Copy On Write
        - 기본적으로 파일시스템의 `ext4`, `XFS` 두 종류는 파일의 배치된 메모리는 변하지 않습니다. 하지만 `Btrfs` 의 경우, 별도의 파일을 새롭게 만들고 메타데이터의 링크를 바꿉니다.
        - 위 예에서 새로운 `app` 디렉토리 구조를 만들어 루트로부터 기존 `app` 링크를 새로운 `app` 링크로 변경합니다.
- 그럼에도 파일시스템이 깨질경우를 대비해 각 파일시스템은 `fsck` 명령어를 통해서 파일시스템을 깨지지 않은 상태로 복구합니다.

---

### 디바이스 파일

- 파일은 일반파일과 파일을 보관하는 디렉토리가 존재하는데, 그외에 리눅스에서는 디바이스 파일이 존재합니다.
- 디바이스 파일의 종류 : 1. 캐릭터장치, 2. 블록 장치
- 각 디바이스 파일은 리눅스의 `/dev` 디렉토리에 존재합니다.
1. 캐릭터 장치 : 읽기와 쓰기는 가능하지만 탐색이 되지 않는 특성을 가집니다.
    - ex : 터미널, 키보드, 마우스
2. 블록 장치 : 일반적인 저장장치로 단순히 파일의 읽기, 쓰기 이외의 랜덤 접근이 가능.
    - 저장장치에 메타데이터와 데이터로 저장된 메모리를 파일시스템을 이용하여(경유하여) 블록장치를 조작합니다.(즉, 직접적으로 블록장치를 사용하지 않습니다.)

---

### 그외 파일시스템의 종류

- 메모리 파일시스템
- 네트워크 파일시스템
- 가상 파일시스템
    - `procfs`  - 프로세스에 대한 정보를 얻기 위한 파일시스템 `/proc` 이하 디렉토리에 마운트 됩니다.
    - `sysfs` - `/sys` 이하 디렉토리에 마운트되며, `procfs` 파일시스템의 무분별한 접근을 제한하기 위해 만든 파일시스템입니다. 시스템에 존재하는 파일시스템의 정보와, 디바이스 정보를 담고 있습니다.

---

### 추가 학습 내용

> RAID (Redundant Array of Inexpensive Disks) 

- 파일시스템 `Btrfs` 에서 지원하며, 데이터의 파손 검출 , 복구를 지원합니다.
- RAID 1 구성인 경우 파일이 손상되어도 다른 스토리지에서 사용가능 합니다.
- 체크썸을 가지고 있어 데이터의 파손 검출 및 복구를 지원

---