# [7장] SQL 옵티마이저

### 7.1 통계정보와 비용 계산의 원리

- `선택도` : 전체 레코드 중에서 조건절에 의해 선택되는 레코드의 비율
- `카디널리티` : 전체 레코드 중에서 조건절에 의해 선택되는 레코드의 개수

<aside>
🔥 카디널리티 : 총 Row * 선택도 = 총 Row / NDV

</aside>

- 선택도와 카디널리티의 계산이 무엇보다 기초된다. 또 그만큼 중요하다.

---

### 7.1.2 통계정보

- 통계정보 → 오브젝트 통계 → 테이블 통계 , 인덱스 통계, 컬럼 통계
              →   시스템 통계(앱 및 하드웨어 성능 특성을 측정)
- 시스템 통계
- CPU속도, 싱글블록 입출력 속도, 평균 멀티블록 입출력 속도, 평균 멀티블록 입출력 개수, 입출력 서브시스템의 최대 처리량, 병렬 슬레이브의 평균 처리량 등을 기록

---

### 7.1.3 비용 계산의 원리

- 위 통계를 기반으로 비용을 계산할 수 있다.
- ‘=‘ 조건 검색시 인덱스 통계만으로 비용 계산이 가능
- 비용 = 인덱스 수직 탐색 비용 + 인덱스 수평 탐색 비용 + 테이블 랜덤액세스 비용
- 모두 `=` 조건이 아닐 경우 컬럼 통계까지 활용
- 비용 = 인덱스 수직탐색 + 인덱스 수평탐색(리프블록 * 유효 인덱스 선택도) + 테이블랜덤액세스(클러스트링 팩터 * 유효 테이블 선택도)
@`유효 인덱스 선택도` : 전체 인덱스 레코드 중에 액세스 조건에의해 선택될 것이라 예상되는 레코드의 비중

---

# 7.2 옵티마이저에 대한 이해

### 7.2.1 옵티마이저의 종류

- `비용기반 옵티마이저` - 실행계획을 도출하고 통계정보를 이용한 비용 산정하여 낮은 비용의 실행계획을 선택하는 옵티마이저
@과거, 우선순위 규칙에 따른 규칙기반 옵티마이저도 존재하였으나, 대량 데이터 처리엔 부적합

---

### 7.2.2 옵티마이저 모드

1. ALL_ROWS : 전체 처리속도 최적화
2. FIRST_ROWS : 최초 응답속도 최적화
3. FIRST_ROWS_N : 최초 N건 응답속도 최적화

---

### 개발자의 할일

- 필요한 최소블록만 읽도록 쿼리를 작성.
- 최적의 옵티마이징 팩터 제공
- 전략적인 인덱스 구성
- 옵티마이저 모드 설정
- 정확하고 안정적인 통계정보 제공
- 옵티마이저 힌트 사용하여 최적의 액세스 경로 유도.

<aside>
🔥 데이터베이스 튜닝은 SQL이 병목이나 지연없이 안정적으로 수행되는 모든 활동도

</aside>

---